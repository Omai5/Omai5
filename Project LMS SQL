--Project LMS SQL .
/* =========================
   ========== DDL ==========
   ========================= */
create database Library_MS;

CREATE TABLE Member (
    Member_ID INT PRIMARY KEY,
    Email VARCHAR(100) UNIQUE,
    FirstName VARCHAR(50),
    MiddleName VARCHAR(50),
    LastName VARCHAR(50),
    City VARCHAR(50),
    StreetNumber VARCHAR(50),
    ZipCode VARCHAR(20)
);

CREATE TABLE PhoneMember (
    Member_ID INT,
    Phone VARCHAR(20),
    PRIMARY KEY (Member_ID, Phone),
    FOREIGN KEY (Member_ID) REFERENCES Member(Member_ID)
);

CREATE TABLE Category (
    Category_ID INT PRIMARY KEY IDENTITY(1,1),
    CategoryName VARCHAR(100) NOT NULL
);

CREATE TABLE Book (
    Book_ID INT PRIMARY KEY,
    Title VARCHAR(200) NOT NULL,
    Author VARCHAR(150) NOT NULL,
    Publisher VARCHAR(150),
    [Status] VARCHAR(50),
    Age_Group VARCHAR(50),
    Category_ID INT,
    CONSTRAINT FK_Book_Category FOREIGN KEY (Category_ID) 
        REFERENCES Category(Category_ID)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

CREATE TABLE Warehouse (
    warehouse_ID INT PRIMARY KEY,
    warehouseLocation VARCHAR(100) ,
    warehousename VARCHAR(50) 
);  

CREATE TABLE Branch (
    Branch_ID INT PRIMARY KEY,
    BranchName VARCHAR(50) ,
    BranchLocation VARCHAR(100) ,
    warehouse_ID INT ,
    FOREIGN KEY (warehouse_ID) REFERENCES Warehouse(warehouse_ID)
);


CREATE TABLE BorrowBook (
    Book_ID INT ,
    Member_ID INT,
    BorrowDate DATE ,
    DueDate DATE ,
    FineAmount DECIMAL(6,2) DEFAULT 0,
    Price DECIMAL(6,2) ,
    PRIMARY KEY (Book_ID, Member_ID),
    FOREIGN KEY (Book_ID) REFERENCES Book(Book_ID),
    FOREIGN KEY (Member_ID) REFERENCES Member(Member_ID)
);

CREATE TABLE BranchStock (
    Book_ID INT ,
    Branch_ID INT ,
    quantityBorrowed INT DEFAULT 0,
    quantityAvailable INT ,
    PRIMARY KEY (Book_ID, Branch_ID),
    FOREIGN KEY (Book_ID) REFERENCES Book(Book_ID),
    FOREIGN KEY (Branch_ID) REFERENCES Branch(Branch_ID)
);


CREATE TABLE Staff (
    employee_ID INT PRIMARY KEY,
    Manager_ID INT UNIQUE,
    NetSalary DECIMAL(8,2) ,
    firstname VARCHAR(50) ,
    middlename VARCHAR(50),
    lastname VARCHAR(50) ,
    Branch_ID INT,
    warehouse_ID INT,
    FOREIGN KEY (Branch_ID) REFERENCES Branch(Branch_ID),
    FOREIGN KEY (warehouse_ID) REFERENCES Warehouse(warehouse_ID)
);
